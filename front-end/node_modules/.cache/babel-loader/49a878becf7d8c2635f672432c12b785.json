{"ast":null,"code":"var _jsxFileName = \"/home/manuel/git/BookflixOficial/BookflixConDisenio/front-end/src/components/VistaSuscriptor/Libros/DetalleLibro.js\";\nimport React, { Component } from \"react\";\nimport axios from \"axios\";\nimport DatosLibro from \"./DatosLibro\";\nimport { Link } from \"react-router-dom\";\nimport ListarCapitulos from \"./ListarCapitulos\";\nimport { Button } from \"react-bootstrap\";\nimport MostrarTrailersAsociados from \"../Trailers/MostrarTrailersAsociados\";\nconst perfiles = \"http://localhost:4000/api/perfiles/\";\nconst editoriales = \"http://localhost:4000/api/editoriales/\";\nconst generos = \"http://localhost:4000/api/generos/\";\nconst autores = \"http://localhost:4000/api/autores/\";\nconst Trailers = \"http://localhost:4000/api/trailers/\";\nconst portada = \"http://localhost:4000/uploads/\";\nconst me = \"http://localhost:4000/api/libros/me\";\nconst capi = \"http://localhost:4000/api/libros/misCapitulos\";\nexport default class DetalleLibrosAdmin extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getNombres = async () => {\n      //traigo el autor actual\n      await axios.post(autores + \"me\", {\n        id: this.state.libro.autor\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        console.log(res.data);\n        this.setState({\n          autor: res.data\n        });\n      }).catch(err => {\n        console.log(err);\n      }); //traigo el genero actual\n\n      await axios.post(generos + \"me\", {\n        id: this.state.libro.genero\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        console.log(res.data);\n        this.setState({\n          genero: res.data\n        });\n      }).catch(err => {\n        console.log(err);\n      }); //traigo la editorial actual\n\n      await axios.post(editoriales + \"me\", {\n        id: this.state.libro.editorial\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        this.setState({\n          editorial: res.data\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n\n    this.getTrailer = async () => {\n      if (this.state.libro.trailer != null) {\n        await axios.post(Trailers + \"me\", {\n          id: this.state.libro.trailer\n        }, {\n          headers: {\n            xaccess: this.state.token\n          }\n        }).then(res => {\n          console.log(res.data);\n          console.log(res.data);\n          this.setState({\n            trailer: res.data\n          });\n        }).catch(err => {\n          console.log(err.response.data.msg);\n        });\n      }\n    };\n\n    this.getDatos = async () => {\n      await axios.post(me, {\n        id: this.state.id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        this.setState({\n          libro: res.data,\n          capitulos: res.data.capitulos\n        });\n        this.getCapitulos();\n        this.getNombres();\n        this.HayCapitulos();\n        this.getTrailer();\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n\n    this.filtrarCapitulos = capi => {\n      var validos = [];\n      var hoy = new Date();\n\n      if (capi != []) {\n        capi.map(cap => {\n          const lanza = new Date(cap.lanzamiento);\n\n          if (lanza <= hoy) {\n            console.log(\"capitulo valido\", cap);\n            validos.push(cap);\n          }\n\n          if (cap.vencimiento) {\n            const venc = new Date(cap.vencimiento);\n\n            if (venc >= hoy) {\n              console.log('capitulo con vencimeinto valido', cap);\n            }\n          }\n        });\n        this.setState({\n          capitulosActivos: validos\n        });\n        console.log(\"Aca le estamos prestando atención\", this.state.capitulosActivos, validos);\n      }\n    };\n\n    this.getCapitulos = async () => {\n      await axios.post(capi, {\n        id: this.props.match.params.id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        console.log(res.data);\n        this.setState({\n          capi: res.data\n        });\n        console.log(\"lo que contiene capi\", this.state.capi);\n        this.filtrarCapitulos(res.data);\n      }).catch(err => {\n        console.log(err);\n        alert(JSON.stringify(err.response.data.msg));\n      });\n    };\n\n    this.HayCapitulos = () => {\n      if (this.state.capitulos != \"\") {\n        this.state.bottonCap = true;\n      }\n    };\n\n    this.leerLibro = async () => {\n      console.log(\"el perfil\");\n      console.log(sessionStorage.getItem(\"perfilID\"));\n      console.log(JSON.parse(sessionStorage.getItem(\"perfilUser\")));\n      await axios.post(perfiles + \"visitadoLibro\", {\n        id: sessionStorage.getItem(\"perfilID\"),\n        libroId: this.state.id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        console.log(res.data);\n      }).catch(err => {\n        console.log(err);\n        alert(JSON.stringify(err.response.data.msg));\n      });\n    };\n\n    this.fechaExpiracion = () => {\n      if (!this.props.libro.fechaExpiracion) {\n        return /*#__PURE__*/React.createElement(\"h6\", {\n          className: \"card-subtitle mb-2 text-muted\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 9\n          }\n        }, \"Fecha de expiraci\\xF3n: \", this.state.libro.expiracion);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 14\n          }\n        });\n      }\n    };\n\n    this.termineLibro = async () => {\n      await axios.post(perfiles + \"termineLibro\", {\n        id: sessionStorage.getItem(\"perfilID\"),\n        libroId: this.state.libro._id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        alert(res.data.msg);\n      }).catch(err => {\n        alert(err.response.data.msg);\n      });\n    };\n\n    this.state = {\n      id: this.props.match.params.id,\n      token: sessionStorage.getItem(\"token\"),\n      libro: \"\",\n      capitulos: \"\",\n      editorial: \"\",\n      genero: \"\",\n      autor: \"\",\n      bottonCap: false,\n      mostrarCapitulos: false,\n      trailer: null,\n      capi: [],\n      capitulosActivos: [],\n      botonTermine: true\n    };\n    this.fechaExpiracion = this.fechaExpiracion.bind(this);\n    this.mostrarCapitulos = this.mostrarCapitulos.bind(this);\n  }\n\n  componentDidMount() {\n    this.getDatos();\n    this.HayCapitulos();\n  }\n\n  mostrarCapitulos() {\n    this.setState({\n      mostrarCapitulos: !this.state.mostrarCapitulos\n    });\n    console.log(this.state.mostrarCapitulos);\n  }\n\n  mostrarTermineLibro() {\n    if (this.state.botonTermine) {}\n  }\n\n  render() {\n    const show = this.state.bottonCap;\n    const termineL = this.state.botonTermine;\n    const capseleccionado = this.state.capseleccionado - 1;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(DatosLibro, {\n      libro: this.state.libro,\n      autor: this.state.autor,\n      genero: this.state.genero,\n      editorial: this.state.editorial,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 9\n      }\n    }), termineL ? /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-outline-success col-md-2 offset-md-3\",\n      onClick: this.termineLibro,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 13\n      }\n    }, \"Termine libro\")) : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 33\n      }\n    }), show ? /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"card col-md-6 offset-md-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-outline-success\",\n      onClick: this.mostrarCapitulos,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 15\n      }\n    }, \" \", \"Ver Capitulos\")), this.state.mostrarCapitulos ?\n    /*#__PURE__*/\n    //console.log(this.state.capitulosActivos),\n    //console.log(this.state.libro._id),\n    React.createElement(ListarCapitulos, {\n      capitulos: this.state.capitulosActivos,\n      libroId: this.state.libro._id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 15\n      }\n    }) : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 17\n      }\n    }, \" \")) : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"card col-md-6 offset-md-3 text-light bg-dark\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"card-body \",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      onClick: this.leerLibro,\n      className: \"btn btn-outline-success itemBoton\",\n      to: \"/suscriptor/libros/leer/\" + this.state.libro.archivo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 21\n      }\n    }, \" \", \"Leer Libro\", \" \"))))), /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(MostrarTrailersAsociados, {\n      trailer: this.state.trailer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}","map":{"version":3,"sources":["/home/manuel/git/BookflixOficial/BookflixConDisenio/front-end/src/components/VistaSuscriptor/Libros/DetalleLibro.js"],"names":["React","Component","axios","DatosLibro","Link","ListarCapitulos","Button","MostrarTrailersAsociados","perfiles","editoriales","generos","autores","Trailers","portada","me","capi","DetalleLibrosAdmin","constructor","props","getNombres","post","id","state","libro","autor","headers","xaccess","token","then","res","console","log","data","setState","catch","err","genero","editorial","getTrailer","trailer","response","msg","getDatos","capitulos","getCapitulos","HayCapitulos","filtrarCapitulos","validos","hoy","Date","map","cap","lanza","lanzamiento","push","vencimiento","venc","capitulosActivos","match","params","alert","JSON","stringify","bottonCap","leerLibro","sessionStorage","getItem","parse","libroId","fechaExpiracion","expiracion","termineLibro","_id","mostrarCapitulos","botonTermine","bind","componentDidMount","mostrarTermineLibro","render","show","termineL","capseleccionado","archivo"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,SAASC,IAAT,QAAqB,kBAArB;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,SAASC,MAAT,QAAuB,iBAAvB;AACA,OAAOC,wBAAP,MAAqC,sCAArC;AAEA,MAAMC,QAAQ,GAAG,qCAAjB;AACA,MAAMC,WAAW,GAAG,wCAApB;AACA,MAAMC,OAAO,GAAG,oCAAhB;AACA,MAAMC,OAAO,GAAG,oCAAhB;AACA,MAAMC,QAAQ,GAAG,qCAAjB;AAEA,MAAMC,OAAO,GAAG,gCAAhB;AACA,MAAMC,EAAE,GAAG,qCAAX;AACA,MAAMC,IAAI,GAAG,+CAAb;AAEA,eAAe,MAAMC,kBAAN,SAAiCf,SAAjC,CAA2C;AACxDgB,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SAqBnBC,UArBmB,GAqBN,YAAY;AACvB;AACA,YAAMjB,KAAK,CACRkB,IADG,CAEFT,OAAO,GAAG,IAFR,EAGF;AAAEU,QAAAA,EAAE,EAAE,KAAKC,KAAL,CAAWC,KAAX,CAAiBC;AAAvB,OAHE,EAIF;AAAEC,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,OAJE,EAMHC,IANG,CAMGC,GAAD,IAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAhB;AACA,aAAKC,QAAL,CAAc;AACZT,UAAAA,KAAK,EAAEK,GAAG,CAACG;AADC,SAAd;AAGD,OAXG,EAYHE,KAZG,CAYIC,GAAD,IAAS;AACdL,QAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD,OAdG,CAAN,CAFuB,CAkBvB;;AACA,YAAMjC,KAAK,CACRkB,IADG,CAEFV,OAAO,GAAG,IAFR,EAGF;AAAEW,QAAAA,EAAE,EAAE,KAAKC,KAAL,CAAWC,KAAX,CAAiBa;AAAvB,OAHE,EAIF;AAAEX,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,OAJE,EAMHC,IANG,CAMGC,GAAD,IAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAhB;AACA,aAAKC,QAAL,CAAc;AACZG,UAAAA,MAAM,EAAEP,GAAG,CAACG;AADA,SAAd;AAGD,OAXG,EAYHE,KAZG,CAYIC,GAAD,IAAS;AACdL,QAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD,OAdG,CAAN,CAnBuB,CAmCvB;;AACA,YAAMjC,KAAK,CACRkB,IADG,CAEFX,WAAW,GAAG,IAFZ,EAGF;AAAEY,QAAAA,EAAE,EAAE,KAAKC,KAAL,CAAWC,KAAX,CAAiBc;AAAvB,OAHE,EAIF;AAAEZ,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,OAJE,EAMHC,IANG,CAMGC,GAAD,IAAS;AACb,aAAKI,QAAL,CAAc;AACZI,UAAAA,SAAS,EAAER,GAAG,CAACG;AADH,SAAd;AAGD,OAVG,EAWHE,KAXG,CAWIC,GAAD,IAAS;AACdL,QAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD,OAbG,CAAN;AAcD,KAvEkB;;AAAA,SA0EnBG,UA1EmB,GA0EN,YAAY;AACvB,UAAI,KAAKhB,KAAL,CAAWC,KAAX,CAAiBgB,OAAjB,IAA4B,IAAhC,EAAsC;AACpC,cAAMrC,KAAK,CACRkB,IADG,CAEFR,QAAQ,GAAG,IAFT,EAGF;AAAES,UAAAA,EAAE,EAAE,KAAKC,KAAL,CAAWC,KAAX,CAAiBgB;AAAvB,SAHE,EAIF;AAAEd,UAAAA,OAAO,EAAE;AAAEC,YAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,SAJE,EAMHC,IANG,CAMGC,GAAD,IAAS;AACbC,UAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAhB;AACAF,UAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAhB;AACA,eAAKC,QAAL,CAAc;AACZM,YAAAA,OAAO,EAAEV,GAAG,CAACG;AADD,WAAd;AAGD,SAZG,EAaHE,KAbG,CAaIC,GAAD,IAAS;AACdL,UAAAA,OAAO,CAACC,GAAR,CAAYI,GAAG,CAACK,QAAJ,CAAaR,IAAb,CAAkBS,GAA9B;AACD,SAfG,CAAN;AAgBD;AACF,KA7FkB;;AAAA,SA+FnBC,QA/FmB,GA+FR,YAAY;AACrB,YAAMxC,KAAK,CACRkB,IADG,CAEFN,EAFE,EAGF;AAAEO,QAAAA,EAAE,EAAE,KAAKC,KAAL,CAAWD;AAAjB,OAHE,EAIF;AAAEI,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,OAJE,EAMHC,IANG,CAMGC,GAAD,IAAS;AACb,aAAKI,QAAL,CAAc;AACZV,UAAAA,KAAK,EAAEM,GAAG,CAACG,IADC;AAEZW,UAAAA,SAAS,EAAEd,GAAG,CAACG,IAAJ,CAASW;AAFR,SAAd;AAIA,aAAKC,YAAL;AACA,aAAKzB,UAAL;AACA,aAAK0B,YAAL;AACA,aAAKP,UAAL;AAED,OAhBG,EAiBHJ,KAjBG,CAiBIC,GAAD,IAAS;AACdL,QAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACD,OAnBG,CAAN;AAoBD,KApHkB;;AAAA,SAuHnBW,gBAvHmB,GAuHC/B,IAAD,IAAU;AAC3B,UAAIgC,OAAO,GAAG,EAAd;AACA,UAAIC,GAAG,GAAG,IAAIC,IAAJ,EAAV;;AACA,UAAIlC,IAAI,IAAI,EAAZ,EAAgB;AACdA,QAAAA,IAAI,CAACmC,GAAL,CAASC,GAAG,IAAI;AACd,gBAAMC,KAAK,GAAC,IAAIH,IAAJ,CAASE,GAAG,CAACE,WAAb,CAAZ;;AACA,cAAID,KAAK,IAAIJ,GAAb,EAAkB;AAChBlB,YAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BoB,GAA9B;AACAJ,YAAAA,OAAO,CAACO,IAAR,CAAaH,GAAb;AACD;;AACD,cAAIA,GAAG,CAACI,WAAR,EAAoB;AAClB,kBAAMC,IAAI,GAAE,IAAIP,IAAJ,CAASE,GAAG,CAACI,WAAb,CAAZ;;AACA,gBAAGC,IAAI,IAAIR,GAAX,EAAe;AACblB,cAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ,EAA+CoB,GAA/C;AACD;AACF;AACF,SAZD;AAcA,aAAKlB,QAAL,CAAc;AACZwB,UAAAA,gBAAgB,EAAEV;AADN,SAAd;AAGAjB,QAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ,EAAiD,KAAKT,KAAL,CAAWmC,gBAA5D,EAA8EV,OAA9E;AAED;AAEF,KAhJkB;;AAAA,SAkJnBH,YAlJmB,GAkJJ,YAAY;AACzB,YAAM1C,KAAK,CAACkB,IAAN,CAAWL,IAAX,EACJ;AAAEM,QAAAA,EAAE,EAAE,KAAKH,KAAL,CAAWwC,KAAX,CAAiBC,MAAjB,CAAwBtC;AAA9B,OADI,EAEJ;AAAEI,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,OAFI,EAIHC,IAJG,CAIGC,GAAD,IAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAaF,GAAG,CAACG,IAAjB;AACA,aAAKC,QAAL,CAAc;AACZlB,UAAAA,IAAI,EAAEc,GAAG,CAACG;AADE,SAAd;AAGAF,QAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAmC,KAAKT,KAAL,CAAWP,IAA9C;AACA,aAAK+B,gBAAL,CAAsBjB,GAAG,CAACG,IAA1B;AAED,OAZG,EAaHE,KAbG,CAaIC,GAAD,IAAS;AACdL,QAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACAyB,QAAAA,KAAK,CAACC,IAAI,CAACC,SAAL,CAAe3B,GAAG,CAACK,QAAJ,CAAaR,IAAb,CAAkBS,GAAjC,CAAD,CAAL;AACD,OAhBG,CAAN;AAiBD,KApKkB;;AAAA,SAuKnBI,YAvKmB,GAuKJ,MAAM;AACnB,UAAI,KAAKvB,KAAL,CAAWqB,SAAX,IAAwB,EAA5B,EAAgC;AAC9B,aAAKrB,KAAL,CAAWyC,SAAX,GAAuB,IAAvB;AACD;AACF,KA3KkB;;AAAA,SA6KnBC,SA7KmB,GA6KP,YAAY;AACtBlC,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYkC,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAAZ;AACApC,MAAAA,OAAO,CAACC,GAAR,CAAY8B,IAAI,CAACM,KAAL,CAAWF,cAAc,CAACC,OAAf,CAAuB,YAAvB,CAAX,CAAZ;AACA,YAAMhE,KAAK,CACRkB,IADG,CAEFZ,QAAQ,GAAG,eAFT,EAGF;AAAEa,QAAAA,EAAE,EAAE4C,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAAN;AAA0CE,QAAAA,OAAO,EAAE,KAAK9C,KAAL,CAAWD;AAA9D,OAHE,EAIF;AAAEI,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,OAJE,EAMHC,IANG,CAMGC,GAAD,IAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACG,IAAhB;AACD,OARG,EASHE,KATG,CASIC,GAAD,IAAS;AACdL,QAAAA,OAAO,CAACC,GAAR,CAAYI,GAAZ;AACAyB,QAAAA,KAAK,CAACC,IAAI,CAACC,SAAL,CAAe3B,GAAG,CAACK,QAAJ,CAAaR,IAAb,CAAkBS,GAAjC,CAAD,CAAL;AACD,OAZG,CAAN;AAaD,KA9LkB;;AAAA,SAqMnB4B,eArMmB,GAqMD,MAAM;AACtB,UAAI,CAAC,KAAKnD,KAAL,CAAWK,KAAX,CAAiB8C,eAAtB,EAAuC;AACrC,4BACE;AAAI,UAAA,SAAS,EAAC,+BAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCACwB,KAAK/C,KAAL,CAAWC,KAAX,CAAiB+C,UADzC,CADF;AAKD,OAND,MAMO;AACL,4BAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACD;AACF,KA/MkB;;AAAA,SAgOnBC,YAhOmB,GAgOJ,YAAY;AACzB,YAAMrE,KAAK,CACRkB,IADG,CAEFZ,QAAQ,GAAG,cAFT,EAGF;AAAEa,QAAAA,EAAE,EAAE4C,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAAN;AAA0CE,QAAAA,OAAO,EAAE,KAAK9C,KAAL,CAAWC,KAAX,CAAiBiD;AAApE,OAHE,EAIF;AAAE/C,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE,KAAKJ,KAAL,CAAWK;AAAtB;AAAX,OAJE,EAMHC,IANG,CAMGC,GAAD,IAAS;AACb+B,QAAAA,KAAK,CAAC/B,GAAG,CAACG,IAAJ,CAASS,GAAV,CAAL;AACD,OARG,EASHP,KATG,CASIC,GAAD,IAAS;AACdyB,QAAAA,KAAK,CAACzB,GAAG,CAACK,QAAJ,CAAaR,IAAb,CAAkBS,GAAnB,CAAL;AACD,OAXG,CAAN;AAaD,KA9OkB;;AAEjB,SAAKnB,KAAL,GAAa;AACXD,MAAAA,EAAE,EAAE,KAAKH,KAAL,CAAWwC,KAAX,CAAiBC,MAAjB,CAAwBtC,EADjB;AAEXM,MAAAA,KAAK,EAAEsC,cAAc,CAACC,OAAf,CAAuB,OAAvB,CAFI;AAGX3C,MAAAA,KAAK,EAAE,EAHI;AAIXoB,MAAAA,SAAS,EAAE,EAJA;AAKXN,MAAAA,SAAS,EAAE,EALA;AAMXD,MAAAA,MAAM,EAAE,EANG;AAOXZ,MAAAA,KAAK,EAAE,EAPI;AAQXuC,MAAAA,SAAS,EAAE,KARA;AASXU,MAAAA,gBAAgB,EAAE,KATP;AAUXlC,MAAAA,OAAO,EAAE,IAVE;AAWXxB,MAAAA,IAAI,EAAE,EAXK;AAYX0C,MAAAA,gBAAgB,EAAE,EAZP;AAaXiB,MAAAA,YAAY,EAAE;AAbH,KAAb;AAeA,SAAKL,eAAL,GAAuB,KAAKA,eAAL,CAAqBM,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAKF,gBAAL,GAAwB,KAAKA,gBAAL,CAAsBE,IAAtB,CAA2B,IAA3B,CAAxB;AACD;;AA6KDC,EAAAA,iBAAiB,GAAG;AAClB,SAAKlC,QAAL;AACA,SAAKG,YAAL;AACD;;AAcD4B,EAAAA,gBAAgB,GAAG;AACjB,SAAKxC,QAAL,CAAc;AACZwC,MAAAA,gBAAgB,EAAE,CAAC,KAAKnD,KAAL,CAAWmD;AADlB,KAAd;AAIA3C,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAKT,KAAL,CAAWmD,gBAAvB;AACD;;AAEDI,EAAAA,mBAAmB,GAAG;AACpB,QAAI,KAAKvD,KAAL,CAAWoD,YAAf,EAA4B,CAE3B;AAEF;;AAoBDI,EAAAA,MAAM,GAAG;AACP,UAAMC,IAAI,GAAG,KAAKzD,KAAL,CAAWyC,SAAxB;AACA,UAAMiB,QAAQ,GAAG,KAAK1D,KAAL,CAAWoD,YAA5B;AACA,UAAMO,eAAe,GAAG,KAAK3D,KAAL,CAAW2D,eAAX,GAA6B,CAArD;AAEA,wBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,UAAD;AACE,MAAA,KAAK,EAAE,KAAK3D,KAAL,CAAWC,KADpB;AAEE,MAAA,KAAK,EAAE,KAAKD,KAAL,CAAWE,KAFpB;AAGE,MAAA,MAAM,EAAE,KAAKF,KAAL,CAAWc,MAHrB;AAIE,MAAA,SAAS,EAAE,KAAKd,KAAL,CAAWe,SAJxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAPF,EAQG2C,QAAQ,gBACP,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAQ,MAAA,SAAS,EAAC,8CAAlB;AAAiE,MAAA,OAAO,EAAE,KAAKT,YAA/E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,CADO,gBAMe,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAd1B,EAoBGQ,IAAI,gBACH,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,KAAK,EAAC,2BAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AACE,MAAA,SAAS,EAAC,yBADZ;AAEE,MAAA,OAAO,EAAE,KAAKN,gBAFhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAIG,GAJH,kBADF,CADF,EAUG,KAAKnD,KAAL,CAAWmD,gBAAX;AAAA;AACC;AACA;AACA,wBAAC,eAAD;AACE,MAAA,SAAS,EAAE,KAAKnD,KAAL,CAAWmC,gBADxB;AAEE,MAAA,OAAO,EAAE,KAAKnC,KAAL,CAAWC,KAAX,CAAiBiD,GAF5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHD,gBAWG,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WArBN,CADG,gBA0BD,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,KAAK,EAAC,8CAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,KAAK,EAAC,YAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,IAAD;AACE,MAAA,OAAO,EAAE,KAAKR,SADhB;AAEE,MAAA,SAAS,EAAC,mCAFZ;AAGE,MAAA,EAAE,EAAE,6BAA6B,KAAK1C,KAAL,CAAWC,KAAX,CAAiB2D,OAHpD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKG,GALH,gBAMW,GANX,CADF,CADF,CADF,CADF,CA9CN,eA+DE,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,wBAAD;AACE,MAAA,OAAO,EAAE,KAAK5D,KAAL,CAAWiB,OADtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CA/DF,CADF;AAuED;;AA/TuD","sourcesContent":["import React, { Component } from \"react\";\nimport axios from \"axios\";\nimport DatosLibro from \"./DatosLibro\";\nimport { Link } from \"react-router-dom\";\nimport ListarCapitulos from \"./ListarCapitulos\";\nimport { Button } from \"react-bootstrap\";\nimport MostrarTrailersAsociados from \"../Trailers/MostrarTrailersAsociados\";\n\nconst perfiles = \"http://localhost:4000/api/perfiles/\";\nconst editoriales = \"http://localhost:4000/api/editoriales/\";\nconst generos = \"http://localhost:4000/api/generos/\";\nconst autores = \"http://localhost:4000/api/autores/\";\nconst Trailers = \"http://localhost:4000/api/trailers/\";\n\nconst portada = \"http://localhost:4000/uploads/\";\nconst me = \"http://localhost:4000/api/libros/me\";\nconst capi = \"http://localhost:4000/api/libros/misCapitulos\";\n\nexport default class DetalleLibrosAdmin extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      id: this.props.match.params.id,\n      token: sessionStorage.getItem(\"token\"),\n      libro: \"\",\n      capitulos: \"\",\n      editorial: \"\",\n      genero: \"\",\n      autor: \"\",\n      bottonCap: false,\n      mostrarCapitulos: false,\n      trailer: null,\n      capi: [],\n      capitulosActivos: [],\n      botonTermine: true,\n    };\n    this.fechaExpiracion = this.fechaExpiracion.bind(this);\n    this.mostrarCapitulos = this.mostrarCapitulos.bind(this);\n  }\n\n  getNombres = async () => {\n    //traigo el autor actual\n    await axios\n      .post(\n        autores + \"me\",\n        { id: this.state.libro.autor },\n        { headers: { xaccess: this.state.token } }\n      )\n      .then((res) => {\n        console.log(res.data);\n        this.setState({\n          autor: res.data,\n        });\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n\n    //traigo el genero actual\n    await axios\n      .post(\n        generos + \"me\",\n        { id: this.state.libro.genero },\n        { headers: { xaccess: this.state.token } }\n      )\n      .then((res) => {\n        console.log(res.data);\n        this.setState({\n          genero: res.data,\n        });\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n\n    //traigo la editorial actual\n    await axios\n      .post(\n        editoriales + \"me\",\n        { id: this.state.libro.editorial },\n        { headers: { xaccess: this.state.token } }\n      )\n      .then((res) => {\n        this.setState({\n          editorial: res.data,\n        });\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n\n  getTrailer = async () => {\n    if (this.state.libro.trailer != null) {\n      await axios\n        .post(\n          Trailers + \"me\",\n          { id: this.state.libro.trailer },\n          { headers: { xaccess: this.state.token } }\n        )\n        .then((res) => {\n          console.log(res.data);\n          console.log(res.data);\n          this.setState({\n            trailer: res.data,\n          });\n        })\n        .catch((err) => {\n          console.log(err.response.data.msg);\n        });\n    }\n  };\n\n  getDatos = async () => {\n    await axios\n      .post(\n        me,\n        { id: this.state.id },\n        { headers: { xaccess: this.state.token } }\n      )\n      .then((res) => {\n        this.setState({\n          libro: res.data,\n          capitulos: res.data.capitulos,\n        });\n        this.getCapitulos();\n        this.getNombres();\n        this.HayCapitulos();\n        this.getTrailer();\n\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n\n  filtrarCapitulos = (capi) => {\n    var validos = [];\n    var hoy = new Date();\n    if (capi != []) {\n      capi.map(cap => {\n        const lanza=new Date(cap.lanzamiento);\n        if (lanza <= hoy) {\n          console.log(\"capitulo valido\",cap)\n          validos.push(cap)\n        }\n        if (cap.vencimiento){\n          const venc= new Date(cap.vencimiento);\n          if(venc >= hoy){\n            console.log('capitulo con vencimeinto valido', cap)\n          }\n        }\n      }\n      )\n      this.setState({\n        capitulosActivos: validos\n      })\n      console.log(\"Aca le estamos prestando atención\", this.state.capitulosActivos, validos)\n\n    }\n\n  }\n\n  getCapitulos = async () => {\n    await axios.post(capi,\n      { id: this.props.match.params.id },\n      { headers: { xaccess: this.state.token } }\n    )\n      .then((res) => {\n        console.log( res.data);\n        this.setState({\n          capi: res.data\n        })\n        console.log(\"lo que contiene capi\",this.state.capi)\n        this.filtrarCapitulos(res.data);\n\n      })\n      .catch((err) => {\n        console.log(err);\n        alert(JSON.stringify(err.response.data.msg));\n      });\n  }\n\n\n  HayCapitulos = () => {\n    if (this.state.capitulos != \"\") {\n      this.state.bottonCap = true;\n    }\n  };\n\n  leerLibro = async () => {\n    console.log(\"el perfil\");\n    console.log(sessionStorage.getItem(\"perfilID\"));\n    console.log(JSON.parse(sessionStorage.getItem(\"perfilUser\")));\n    await axios\n      .post(\n        perfiles + \"visitadoLibro\",\n        { id: sessionStorage.getItem(\"perfilID\"), libroId: this.state.id },\n        { headers: { xaccess: this.state.token } }\n      )\n      .then((res) => {\n        console.log(res.data);\n      })\n      .catch((err) => {\n        console.log(err);\n        alert(JSON.stringify(err.response.data.msg));\n      });\n  };\n\n  componentDidMount() {\n    this.getDatos();\n    this.HayCapitulos();\n  }\n\n  fechaExpiracion = () => {\n    if (!this.props.libro.fechaExpiracion) {\n      return (\n        <h6 className=\"card-subtitle mb-2 text-muted\">\n          Fecha de expiración: {this.state.libro.expiracion}\n        </h6>\n      );\n    } else {\n      return <div />;\n    }\n  };\n\n  mostrarCapitulos() {\n    this.setState({\n      mostrarCapitulos: !this.state.mostrarCapitulos\n\n    });\n    console.log(this.state.mostrarCapitulos)\n  }\n\n  mostrarTermineLibro() {\n    if (this.state.botonTermine){\n\n    }\n\n  }\n\n  termineLibro = async () => {\n    await axios\n      .post(\n        perfiles + \"termineLibro\",\n        { id: sessionStorage.getItem(\"perfilID\"), libroId: this.state.libro._id },\n        { headers: { xaccess: this.state.token } }\n      )\n      .then((res) => {\n        alert(res.data.msg);\n      })\n      .catch((err) => {\n        alert(err.response.data.msg);\n      });\n\n  };\n\n\n\n  render() {\n    const show = this.state.bottonCap;\n    const termineL = this.state.botonTermine;\n    const capseleccionado = this.state.capseleccionado - 1;\n\n    return (\n      <div>\n        <DatosLibro\n          libro={this.state.libro}\n          autor={this.state.autor}\n          genero={this.state.genero}\n          editorial={this.state.editorial}\n        ></DatosLibro>\n        <br></br>\n        {termineL ? (\n          <React.Fragment>\n            <button className=\"btn btn-outline-success col-md-2 offset-md-3\" onClick={this.termineLibro}>\n              Termine libro\n        </button>\n            \n          </React.Fragment>) : (<React.Fragment></React.Fragment>)\n\n        }\n\n\n\n        {show ? (\n          <React.Fragment>\n            <div class=\"card col-md-6 offset-md-3\">\n              <button\n                className=\"btn btn-outline-success\"\n                onClick={this.mostrarCapitulos}\n              >\n                {\" \"}\n                Ver Capitulos\n              </button>\n            </div>\n            {this.state.mostrarCapitulos ? (\n              //console.log(this.state.capitulosActivos),\n              //console.log(this.state.libro._id),\n              <ListarCapitulos\n                capitulos={this.state.capitulosActivos}\n                libroId={this.state.libro._id}\n              ></ListarCapitulos>\n\n\n            ) : (\n\n                <React.Fragment> </React.Fragment>\n              )}\n          </React.Fragment>\n        ) : (\n            <React.Fragment>\n              <div>\n                <div class=\"card col-md-6 offset-md-3 text-light bg-dark\">\n                  <div class=\"card-body \">\n                    <Link\n                      onClick={this.leerLibro}\n                      className=\"btn btn-outline-success itemBoton\"\n                      to={\"/suscriptor/libros/leer/\" + this.state.libro.archivo}\n                    >\n                      {\" \"}\n                    Leer Libro{\" \"}\n                    </Link>\n                  </div>\n                </div>\n              </div>\n            </React.Fragment>\n          )}\n        <React.Fragment>\n          <MostrarTrailersAsociados\n            trailer={this.state.trailer}\n          ></MostrarTrailersAsociados>\n        </React.Fragment>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}